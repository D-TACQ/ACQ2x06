#!/bin/sh

mkdir -p /dev/gpio
cd /sys/class/gpio

setO() {
	echo out >$1/direction
}
setAL() {
	echo 1 >$1/active_low
}
mkln() {
	ln -s $PWD/$1/value /dev/gpio/$2
	if [ "x$3" = "xAL" ]; then
		setAL $1
	fi
}

for pin in $(seq 200 255)
do
	echo $pin >export
done


for pin in $(seq 240 247) $(seq 232 239)
do
	setO gpio$pin
done

mkdir -p /dev/gpio/CLK/RDW
mkln gpio240 CLK/RDW/R6
mkln gpio241 CLK/RDW/R5
mkln gpio242 CLK/RDW/R4
mkln gpio243 CLK/RDW/R3
mkln gpio244 CLK/RDW/R2
mkln gpio245 CLK/RDW/R1
mkln gpio246 CLK/RDW/R0

mkdir /dev/gpio/CLK/FDW
mkln gpio247 CLK/FDW/F6
mkln gpio232 CLK/FDW/F5
mkln gpio233 CLK/FDW/F4
mkln gpio234 CLK/FDW/F3
mkln gpio235 CLK/FDW/F2
mkln gpio236 CLK/FDW/F1
mkln gpio237 CLK/FDW/F0

mkdir /dev/gpio/CLK/ODW
mkln gpio238 CLK/ODW/S1
mkln gpio239 CLK/ODW/S0


let site=1; while [ $site -le 6 ]; do
	let gpio=248+$site-1
	GPIO=gpio${gpio}
	setAL $GPIO; mkln ${GPIO} fmc${site}_present
	let site=$site+1
done

mkln gpio254 15VP_PGD 		AL
mkln gpio255 15VN_PGD 		AL


for pin in $(seq 224 231) $(seq 216 219)
do
	setO gpio${pin}
done

mkln gpio224 ICS_CLK2_OE
mkln gpio225 OSC_X_OE 		AL
mkln gpio226 OSC_X_CLK_OE	AL
mkln gpio227 FP_CLK_OE 		AL
mkln gpio228 FP_OE		AL
mkln gpio229 Si570_OE
mkln gpio230 15VA_EN		AL
mkln gpio231 PSU_SYNC_CLK_OE

mkdir -p /dev/gpio/LED
mkln gpio216 LED/CLK_G 		AL
mkln gpio217 LED/CLK_R 		AL
mkln gpio218 LED/TRG_G 		AL
mkln gpio219 LED/TRG_R 		AL

mkln gpio220 BV_EE
mkln gpio221 BV_RSV1
mkln gpio222 BV_RSV2
mkln gpio223 JTAG14_ALL

# LP3943ISQ

for pin in $(seq 200 214)
do
	setO gpio${pin}
done

mkln gpio200 FAN_EN 
mkln gpio201 LED/FMC1_G 	AL
mkln gpio202 LED/FMC2_G 	AL
mkln gpio203 LED/FMC3_G		AL
mkln gpio204 LED/FMC4_G 	AL
mkln gpio205 LED/FMC5_G 	AL
mkln gpio206 LED/FMC6_G 	AL
mkln gpio207 LED/FMC1_R 	AL
mkln gpio208 LED/FMC2_R 	AL
mkln gpio209 LED/FMC3_R 	AL
mkln gpio210 LED/FMC4_R 	AL
mkln gpio211 LED/FMC5_R 	AL
mkln gpio212 LED/FMC6_R 	AL
mkln gpio213 LED/ACT_G  	AL
mkln gpio214 LED/ACT_R  	AL
	
clear_leds() {	
	for LED in /dev/gpio/LED/*
	do
		echo 0 > $LED
	done
}

test_leds() {
	for LED in /dev/gpio/LED/*
	do
		echo 1 > $LED
		sleep 0.2
		echo 0 > $LED
	done
}
	
clear_leds
test_leds


# OK, this isn't gpio, but it's handy to put it here:

mkdir -p /dev/hwmon0
ln -s /sys/class/hwmon/hwmon0/device/temp1_input /dev/hwmon0/temp
ln -s /sys/class/hwmon/hwmon0/device/in1_input	 /dev/hwmon0/15VA_N
ln -s /sys/class/hwmon/hwmon0/device/in2_input	 /dev/hwmon0/15VA_P
ln -s /sys/class/hwmon/hwmon0/device/in3_input	 /dev/hwmon0/5V_P
ln -s /sys/class/hwmon/hwmon0/device/in4_input	 /dev/hwmon0/VADJ


